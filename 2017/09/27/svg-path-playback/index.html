<!DOCTYPE html><html><head><meta charset="utf-8"><title>SVG轨迹回放实践 | 刘一奇的个人博客</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="google-site-verification" content="pGU1zAlgx4MyYfhiix_1nJzPw60bF-dscJn6KBIm7dU"><meta name="description" content="最近做了埋点方案XTracker的轨迹回放功能，大致效果就是，在指定几个顺序的点之间形成轨迹，来模拟用户在页面上的先后行为（比如一个用户先点了啥，后点了啥）。效果图如下：  在这篇文章中，我们来聊聊轨迹回放的一些技术细节。  注意，本文只关注轨迹的绘制，并不讨论轨迹的各种生成算法。"><meta name="keywords" content="SVG,贝塞尔曲线,SVG SMIL animation"><meta property="og:type" content="article"><meta property="og:title" content="SVG轨迹回放实践"><meta property="og:url" content="http://www.liuyiqi.cn/2017/09/27/svg-path-playback/index.html"><meta property="og:site_name" content="刘一奇的个人博客"><meta property="og:description" content="最近做了埋点方案XTracker的轨迹回放功能，大致效果就是，在指定几个顺序的点之间形成轨迹，来模拟用户在页面上的先后行为（比如一个用户先点了啥，后点了啥）。效果图如下：  在这篇文章中，我们来聊聊轨迹回放的一些技术细节。  注意，本文只关注轨迹的绘制，并不讨论轨迹的各种生成算法。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://wx1.sinaimg.cn/mw690/83900b4egy1fk1jn3atyng204h04ead8.gif"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy4xjj4aij203403g0py.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy50l2qlrj20dw0d8wei.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy6fw4aeuj205a04g3yd.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy6fi0z8pj205a04gglj.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy6hbu8zlj205k05kt8o.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy6s1oe7uj203c02gq2p.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy7sndvwjj20hy0cgjrr.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy8a993prj203e032a9t.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy8a993prj203e032a9t.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy8i3vmmij206w05s3yh.jpg"><meta property="og:image" content="https://wx3.sinaimg.cn/mw690/83900b4egy1fk1jn3f98vg204h04edfz.gif"><meta property="og:image" content="https://wx1.sinaimg.cn/mw690/83900b4egy1fk1jn3atyng204h04ead8.gif"><meta property="og:updated_time" content="2017-10-10T03:19:15.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SVG轨迹回放实践"><meta name="twitter:description" content="最近做了埋点方案XTracker的轨迹回放功能，大致效果就是，在指定几个顺序的点之间形成轨迹，来模拟用户在页面上的先后行为（比如一个用户先点了啥，后点了啥）。效果图如下：  在这篇文章中，我们来聊聊轨迹回放的一些技术细节。  注意，本文只关注轨迹的绘制，并不讨论轨迹的各种生成算法。"><meta name="twitter:image" content="https://wx1.sinaimg.cn/mw690/83900b4egy1fk1jn3atyng204h04ead8.gif"><link rel="alternate" href="/atom.xml" title="刘一奇的个人博客" type="application/atom+xml"><link rel="icon" href="/css/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/jquery-disqus-proxy.css"></head><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"> <a href="/" id="logo">刘一奇的个人博客</a></h1><h2 id="subtitle-wrap"> <a href="/" id="subtitle">何以升华，唯有沉淀</a></h2></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/">主页</a> <a class="main-nav-link" href="/archives">归档</a> <a class="main-nav-link" href="/about">关于我</a></nav><nav id="sub-nav"><a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a><a id="nav-search-btn" class="nav-icon" title="搜索"></a></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.liuyiqi.cn"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-svg-path-playback" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"> <a href="/2017/09/27/svg-path-playback/" class="article-date"><time datetime="2017-09-27T11:00:00.000Z" itemprop="datePublished">2017-09-27</time></a></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name"> SVG轨迹回放实践</h1></header><div class="article-entry" itemprop="articleBody"><p>最近做了埋点方案XTracker的轨迹回放功能，大致效果就是，在指定几个顺序的点之间形成轨迹，来模拟用户在页面上的先后行为（比如一个用户先点了啥，后点了啥）。效果图如下：</p><p><img src="https://wx1.sinaimg.cn/mw690/83900b4egy1fk1jn3atyng204h04ead8.gif" alt=""></p><p>在这篇文章中，我们来聊聊轨迹回放的一些技术细节。</p><blockquote><p>注意，本文只关注轨迹的绘制，并不讨论轨迹的各种生成算法。</p></blockquote><a id="more"></a><h2 id="绘制红点坐标"><a href="#绘制红点坐标" class="headerlink" title="绘制红点坐标"></a>绘制红点坐标</h2><p>在绘制轨迹前，需要先绘制轨迹经过的红点坐标。使用SVG绘制红点非常简单：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"500"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">circle</span> <span class="attr">r</span>=<span class="string">"5"</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"55"</span> <span class="attr">fill</span>=<span class="string">"red"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div></pre></td></tr></table></figure><p><img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy4xjj4aij203403g0py.jpg" alt=""></p><p>然后根据需要多画几个红点就可以了，也可以通过js批量生成：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCircles</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> r = <span class="string">"5"</span>,</div><div class="line">    fill = <span class="string">"red"</span>,</div><div class="line">    <span class="comment">// circleGroup是红点的容器</span></div><div class="line">    circleGroup = <span class="built_in">document</span>.querySelector(<span class="string">"#circle-group"</span>);</div><div class="line">  <span class="comment">// pointList是红点的坐标集合</span></div><div class="line">  pointList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">point</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> circle = <span class="built_in">document</span>.createElementNS(</div><div class="line">      <span class="string">"http://www.w3.org/2000/svg"</span>,</div><div class="line">      <span class="string">"circle"</span></div><div class="line">    );</div><div class="line">    circle.setAttribute(<span class="string">"r"</span>, r);</div><div class="line">    circle.setAttribute(<span class="string">"cx"</span>, point[<span class="number">0</span>]);</div><div class="line">    circle.setAttribute(<span class="string">"cy"</span>, point[<span class="number">1</span>]);</div><div class="line">    circle.setAttribute(<span class="string">"fill"</span>, fill);</div><div class="line">    circleGroup.appendChild(circle);</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy50l2qlrj20dw0d8wei.jpg" alt=""></p><h2 id="两点之间的轨迹"><a href="#两点之间的轨迹" class="headerlink" title="两点之间的轨迹"></a>两点之间的轨迹</h2><p>红点坐标画完了，我们来画轨迹。在画多点的轨迹之前，我们先来学习两点之间的轨迹，也就是两点之间曲线的画法。</p><h3 id="二次贝塞尔曲线、三次贝塞尔曲线还是圆弧？"><a href="#二次贝塞尔曲线、三次贝塞尔曲线还是圆弧？" class="headerlink" title="二次贝塞尔曲线、三次贝塞尔曲线还是圆弧？"></a>二次贝塞尔曲线、三次贝塞尔曲线还是圆弧？</h3><p>SVG通过path可以画多种曲线主要包括：</p><ul><li>二次贝塞尔曲线：需要一个控制点，用来确定起点和终点的曲线斜率。<br> <img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy6fw4aeuj205a04g3yd.jpg" alt=""></li><li>三次贝塞尔曲线：需要两个控制点，用来确定起点和终点的曲线斜率。<br> <img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy6fi0z8pj205a04gglj.jpg" alt=""></li><li>圆弧：需要两个半径、旋转角度、逆时针还是顺时针、大圆弧还是小圆弧等多个属性。<br> <img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy6hbu8zlj205k05kt8o.jpg" alt=""></li></ul><p>显然，二次贝塞尔曲线最为简单，所以我们决定用二次贝塞尔曲线来画两点之间的弧线。在SVG的path中，二次贝塞曲线的参数是：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">M x1 y1 Q x2 y2 x3 y3</div></pre></td></tr></table></figure><p>其中<code>x1 y1</code>是起点，<code>x2 y2</code>是控制点，<code>x3 y3</code>是终点。来个demo吧！</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"320px"</span> <span class="attr">height</span>=<span class="string">"320px"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">"line1"</span> <span class="attr">stroke</span>=<span class="string">"black"</span> <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">d</span>=<span class="string">"M 0 50 Q 25 10 50 50"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div></pre></td></tr></table></figure><p>效果：</p><p><img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy6s1oe7uj203c02gq2p.jpg" alt=""></p><h3 id="确定控制点"><a href="#确定控制点" class="headerlink" title="确定控制点"></a>确定控制点</h3><p>确定了使用二次贝塞尔曲线，那么问题又来了，如何确定控制点呢？控制点决定了曲线的斜率和方向，我们期望曲线：</p><ul><li>对称。</li><li>接近直线，稍微弯曲即可，太弯可能会超出画布范围。</li><li>曲线永远顺时针，这样可以保证，A点到B点的曲线和B点到A点的曲线不重合。</li></ul><p>要想做到这三点，我们只需要让控制点：</p><ul><li>在两点的中垂线上。</li><li>距离两点的中点等于某个较小的固定值。</li><li>在起点和终点的顺时针区域。</li></ul><p>画个图吧！</p><p><img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy7sndvwjj20hy0cgjrr.jpg" alt=""></p><ul><li>在顺时针区域画中垂线。中垂线和垂直线的角度为<code>angle</code></li><li>规定<code>offset</code>为某个定值（比如40，或者其他比较小的定值）。</li><li>那么控制点相对于中点的偏移值就确定了：<ul><li><code>offsetX = Math.sin(angle) * offset;</code></li><li><code>offsetY = -Math.cos(angle) * offset;</code></li></ul></li></ul><p>完整算法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCtlPoint</span>(<span class="params">startX, startY, endX, endY, offset</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> offset = offset || <span class="number">40</span>;</div><div class="line">  <span class="keyword">var</span> angle = <span class="built_in">Math</span>.atan2(endY - startY, endX - startX);</div><div class="line">  <span class="keyword">var</span> offsetX = <span class="built_in">Math</span>.sin(angle) * offset;</div><div class="line">  <span class="keyword">var</span> offsetY = -<span class="built_in">Math</span>.cos(angle) * offset;</div><div class="line">  <span class="keyword">var</span> ctlX = (startX + endX) / <span class="number">2</span> + offsetX;</div><div class="line">  <span class="keyword">var</span> ctlY = (startY + endY) / <span class="number">2</span> + offsetY;</div><div class="line">  <span class="keyword">return</span> [ctlX, ctlY];</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="起点终点相同的情况"><a href="#起点终点相同的情况" class="headerlink" title="起点终点相同的情况"></a>起点终点相同的情况</h3><p>如果起点终点相同，我们就不能使用二次贝塞尔曲线了，而是应该在该点右侧画一个小圆弧，就像这样：</p><p><img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy8a993prj203e032a9t.jpg" alt=""></p><p>在Path中圆弧的参数格式为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">A rx ry x-axis-rotation large-arc-flag sweep-flag x y</div></pre></td></tr></table></figure><ul><li>弧形命令A的前两个参数分别是x轴半径和y轴半径。</li><li><code>x-axis-rotation</code>表示弧形的旋转情况。</li><li><code>large-arc-flag</code>决定弧线是大于还是小于180度，0表示小角度弧，1表示大角度弧。</li><li><code>sweep-flag</code>表示弧线的方向，0表示从起点到终点沿逆时针画弧，1表示从起点到终点沿顺时针画弧。</li><li>最后两个参数是指定弧形的终点。</li></ul><blockquote><p>弧形命令A的具体用法不属于本文范畴，请参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial/Paths" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial/Paths</a> 。</p></blockquote><p>因为我们要求：</p><ul><li>圆弧接近于圆，不是椭圆。</li><li>圆弧在右侧。</li><li>大于180度。</li></ul><p>所以，我们的圆弧参数为：</p><ul><li>x轴和y轴半径同为某个很小的定值（我们就设为10吧）</li><li><code>x-axis-rotation</code>为0，不需要旋转，既然是圆，转了也白转。</li><li><code>large-arc-flag</code>为1，显然大于180度。</li><li><code>sweep-flag</code>为1或0都行，不过要保证为1时，终点稍微比起点靠下一点，这样才能保证圆弧在右边。</li></ul><p>示例代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"320px"</span> <span class="attr">height</span>=<span class="string">"320px"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">"line1"</span> <span class="attr">stroke</span>=<span class="string">"black"</span> <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">d</span>=<span class="string">"M 50 50 A 10 10 0 1 1 50 50.1"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div></pre></td></tr></table></figure><p>效果截图：</p><p><img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy8a993prj203e032a9t.jpg" alt=""></p><p>将两种情况封装成获取d属性的函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getD</span>(<span class="params">startX, startY, endX, endY</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> ctlPoint = getCtlPoint(startX, startY, endX, endY, <span class="number">40</span>);</div><div class="line">  <span class="keyword">var</span> d = [<span class="string">"M"</span>, startX, startY].join(<span class="string">" "</span>);</div><div class="line">  <span class="keyword">if</span> (startX !== endX || startY !== endY) &#123;</div><div class="line">    d += [<span class="string">" Q"</span>, ctlPoint[<span class="number">0</span>], ctlPoint[<span class="number">1</span>], endX, endY].join(<span class="string">" "</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    d += [<span class="string">" A"</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, endX, endY + <span class="number">0.1</span>].join(<span class="string">" "</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> d;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>完整demo：</p><p><a href="https://codepen.io/lewis617/pen/JrWMBy/" target="_blank" rel="external">https://codepen.io/lewis617/pen/JrWMBy/</a></p><h2 id="多点之间的轨迹"><a href="#多点之间的轨迹" class="headerlink" title="多点之间的轨迹"></a>多点之间的轨迹</h2><p>两点之间弧线确定了，那么如何确定多点之间的轨迹呢？其实很简单，只需要在命令后面加上新的控制点和终点即可：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">M x1 y1 Q x2 y2 x3 y3 Q x4 y4 x5 y5</div></pre></td></tr></table></figure><p>所以只需要简单更新一下之前封装的函数即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getD</span>(<span class="params">pointList</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> offset = offset || <span class="number">40</span>;</div><div class="line">  <span class="keyword">var</span> d = ([<span class="string">'M'</span> ,pointList[<span class="number">0</span>][<span class="number">0</span>], pointList[<span class="number">0</span>][<span class="number">1</span>]]).join(<span class="string">' '</span>);</div><div class="line">  pointList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">point, i</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</div><div class="line">      <span class="keyword">var</span> startX = pointList[i<span class="number">-1</span>][<span class="number">0</span>],</div><div class="line">          startY = pointList[i<span class="number">-1</span>][<span class="number">1</span>],</div><div class="line">          endX = point[<span class="number">0</span>], </div><div class="line">          endY = point[<span class="number">1</span>];</div><div class="line">      </div><div class="line">      <span class="keyword">var</span> ctlPoint = getCtlPoint(startX, startY, endX, endY, offset);</div><div class="line">      </div><div class="line">      <span class="keyword">if</span>(startX !== endX || startY !== endY)&#123;</div><div class="line">        d+=([<span class="string">' Q'</span>, ctlPoint[<span class="number">0</span>], ctlPoint[<span class="number">1</span>], endX, endY]).join(<span class="string">' '</span>);</div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">        d+=([<span class="string">' A'</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, endX, endY + <span class="number">0.1</span>]).join(<span class="string">' '</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  <span class="keyword">return</span> d;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>如果<code>pointList</code>为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> pointList = [</div><div class="line">  [<span class="number">0</span>, <span class="number">50</span>],</div><div class="line">  [<span class="number">0</span>, <span class="number">50</span>],</div><div class="line">  [<span class="number">50</span>, <span class="number">50</span>],</div><div class="line">  [<span class="number">100</span>, <span class="number">50</span>],</div><div class="line">  [<span class="number">0</span>, <span class="number">100</span>],</div><div class="line">  [<span class="number">50</span>, <span class="number">100</span>],</div><div class="line">  [<span class="number">100</span>, <span class="number">100</span>],</div><div class="line">];</div></pre></td></tr></table></figure><p>那么效果图：</p><p><img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fjy8i3vmmij206w05s3yh.jpg" alt=""></p><p>完整demo：</p><p><a href="https://codepen.io/lewis617/pen/wrJpGY/" target="_blank" rel="external">https://codepen.io/lewis617/pen/wrJpGY/</a></p><h2 id="让轨迹回放起来"><a href="#让轨迹回放起来" class="headerlink" title="让轨迹回放起来"></a>让轨迹回放起来</h2><p>轨迹画完了，如何让它回放呢？这里需要用到这两个属性：</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/stroke-dasharray" target="_blank" rel="external">stroke-dasharray</a>：控制用来描边的点划线的图案范式。</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/stroke-dashoffset" target="_blank" rel="external">stroke-dashoffset</a>：指定了dash模式到路径开始的距离。</p><ul><li>先设置<code>stroke-dasharray</code>为 <code>&quot;length length&quot;</code>，来让曲线颜色和空白的长度均为曲线长度。</li><li>然后设置<code>stroke-dashoffset</code>初始状态为曲线长度，来保证整个曲线”看起来”都是空白。</li><li>最后渐变<code>stroke-dashoffset</code>属性为0，来模拟画线。</li></ul><p>如何渐变呢？使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/SVG_animation_with_SMIL" target="_blank" rel="external">SVG SMIL animation</a>。</p><p>关键代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> length = path.getTotalLength();</div><div class="line">path.setAttribute(<span class="string">"stroke-dasharray"</span>, length + <span class="string">" "</span> + length);</div><div class="line">path.setAttribute(<span class="string">"stroke-dashoffset"</span>, length);</div><div class="line">path.innerHTML= <span class="string">'&lt;animate attributeName="stroke-dashoffset" to="0"  dur="7s" begin="0s" fill="freeze" repeatCount="indefinite"/&gt;'</span>;</div></pre></td></tr></table></figure><p>完整demo：</p><p><img src="https://wx3.sinaimg.cn/mw690/83900b4egy1fk1jn3f98vg204h04edfz.gif" alt=""></p><p><a href="https://codepen.io/lewis617/pen/vexjyp/" target="_blank" rel="external">https://codepen.io/lewis617/pen/vexjyp/</a></p><h2 id="给轨迹加上“圆头”"><a href="#给轨迹加上“圆头”" class="headerlink" title="给轨迹加上“圆头”"></a>给轨迹加上“圆头”</h2><p>马上就可以看见胜利的曙光了，最后我们来做轨迹的“圆头”：</p><ul><li>圆头就是个圆点（circle）</li><li>圆点需要跟着轨迹一起移动</li></ul><p>画一个圆点很简单，那么如何画一个按照轨迹移动的圆点呢？答案是：<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/animateMotion" target="_blank" rel="external">animateMotion元素</a>。</p><p>关键代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPathHead</span>(<span class="params">pathObj, d</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> r = <span class="number">3</span>;</div><div class="line">  <span class="keyword">var</span> head = <span class="built_in">document</span>.createElementNS(<span class="string">"http://www.w3.org/2000/svg"</span>, <span class="string">"circle"</span>);</div><div class="line">  head.setAttribute(<span class="string">"id"</span>, pathObj.id + <span class="string">"-head"</span>);</div><div class="line">  head.setAttribute(<span class="string">"r"</span>, r);</div><div class="line">  head.setAttribute(<span class="string">"fill"</span>, pathObj.stroke);</div><div class="line">  </div><div class="line">  <span class="keyword">var</span> animateMotion = <span class="built_in">document</span>.createElementNS(<span class="string">"http://www.w3.org/2000/svg"</span>, <span class="string">"animateMotion"</span>);</div><div class="line">  animateMotion.setAttribute(<span class="string">"path"</span>, d);</div><div class="line">  animateMotion.setAttribute(<span class="string">"begin"</span>, <span class="string">"indefinite"</span>);</div><div class="line">  animateMotion.setAttribute(<span class="string">"dur"</span>, <span class="string">"7s"</span>);</div><div class="line">  animateMotion.setAttribute(<span class="string">"fill"</span>, <span class="string">"freeze"</span>);</div><div class="line">  animateMotion.setAttribute(<span class="string">"rotate"</span>, <span class="string">"auto"</span>);</div><div class="line">  head.appendChild(animateMotion);</div><div class="line">  </div><div class="line">  <span class="keyword">return</span> head;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>至此，轨迹回放的关键技术点就讲完了，再次欣赏下最终的效果：</p><p><img src="https://wx1.sinaimg.cn/mw690/83900b4egy1fk1jn3atyng204h04ead8.gif" alt=""></p><p>完整的demo在这里：</p><p><a href="https://codepen.io/lewis617/pen/RLpxPj/" target="_blank" rel="external">https://codepen.io/lewis617/pen/RLpxPj/</a></p><div class="copyright"><div> <strong>本文作者：</strong> <a href="/about/" title="欢迎访问 刘一奇 的博客">刘一奇</a></div><div> <strong>本文出处：</strong> <a href="/" title="刘一奇的个人博客">刘一奇的个人博客</a></div><div> <strong>本文链接：</strong> <a href="http://www.liuyiqi.cn/2017/09/27/svg-path-playback/" title="SVG轨迹回放实践">http://www.liuyiqi.cn/2017/09/27/svg-path-playback/</a></div><div> <strong>发布时间：</strong> 2017年9月27日 - 19时09分</div><div> <strong>版权声明：</strong> 本文由 刘一奇 原创，采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="license" target="_blank">保留署名-非商业性使用-禁止演绎 4.0-国际许可协议</a><br>转载请保留以上声明信息！</div></div><style type="text/css">#donate_module{margin:20px}.center{text-align:center}.hidden{display:none}.donate_bar a.btn_donate{display:inline-block;width:82px;height:82px;background:url(https://wx4.sinaimg.cn/large/83900b4egy1fktc7oetj4g202a06y0so.gif) no-repeat}.donate_bar a.btn_donate:hover{background-position:0 -82px}.donate_bar .donate_txt{display:block;color:#9d9d9d;font:14px/2 "Microsoft Yahei";margin:10px 0 20px}#donate_guide{width:80%;margin:0 auto}.donate_bar .img-container{width:50%;float:left}.donate_bar .img-container img{width:80%;max-width:200px}.bold{font-weight:700}</style><div id="donate_module"><div id="donate_board" class="donate_bar center"><a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a> <span class="donate_txt">如果您觉得本博客帮到了您，就打赏支持一下吧～</span></div><div id="donate_guide" class="donate_bar center hidden"><div class="img-container"> <img src="https://ws1.sinaimg.cn/mw690/83900b4egy1fkffpj1qktj208c08cmzs.jpg" alt="微信打赏" title="微信打赏"></div><div class="img-container"> <img src="https://ws1.sinaimg.cn/mw690/83900b4egy1fkffpiveorj208c08cac1.jpg" alt="支付宝打赏" title="支付宝打赏"></div></div><script type="text/javascript">document.getElementById("btn_donate").onclick=function(){$("#donate_guide").toggleClass("hidden")}</script></div></div><footer class="article-footer"> <a data-url="http://www.liuyiqi.cn/2017/09/27/svg-path-playback/" data-id="cjblrpsam0036qve13pqlp4jo" class="article-share-link">共享</a> <a href="http://www.liuyiqi.cn/2017/09/27/svg-path-playback/#disqus_proxy_thread" class="article-comment-link">留言</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SVG/">SVG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SVG-SMIL-animation/">SVG SMIL animation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/贝塞尔曲线/">贝塞尔曲线</a></li></ul></footer></div><nav id="article-nav"> <a href="/2017/10/22/immutable-data-structures-for-functional-js/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">下一篇</strong><div class="article-nav-title"> Anjana Vakil：函数式 JS 中的不可变数据结构（译）</div></a> <a href="/2017/09/04/preact-into-the-void-0/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">上一篇</strong><div class="article-nav-title">Jason Miller：Preact：Into the void 0（译）</div></a></nav></article><section id="comments"><div id="disqus_thread"></div><div id="disqus_proxy_thread"></div></section><script>window.disqusProxy={shortname:"lewis617s-blog",username:"lewis617",server:"disqus-proxy.herokuapp.com",port:80,adminAvatar:"//ws4.sinaimg.cn/mw690/83900b4egy1fkuw5hqw8vj202s02ygm1.jpg",identifier:"2017/09/27/svg-path-playback/"},window.disqus_config=function(){this.page.url=window.location.href,this.page.identifier=window.disqusProxy.identifier}</script></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">公告</h3><div class="widget"><ul><li><a href="/2016/11/20/r2-book/" target="_blank">《React 与 Redux 开发实例精解》出版了！</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">系列文章</h3><div class="widget"><ul><li><a href="/tags/React/">React 与 Redux 系列教程</a></li><li><a href="/tags/Angular2/">Angular2 系列教程</a></li><li><a href="/tags/数据结构与算法/">JavaScript 版数据结构与算法</a></li><li><a href="/tags/测试/">前端测试系列教程</a></li><li><a href="/tags/practical-js/">实用的 JavaScript 系列教程</a></li><li><a href="/tags/技术讲座/">技术讲座中文字幕集合</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">标签云</h3><div class="widget tagcloud"> <a href="/tags/Android/" style="font-size:10px">Android</a> <a href="/tags/Angular/" style="font-size:12px">Angular</a> <a href="/tags/Angular2/" style="font-size:17px">Angular2</a> <a href="/tags/Appium/" style="font-size:11px">Appium</a> <a href="/tags/Babel/" style="font-size:10px">Babel</a> <a href="/tags/Bootstrap/" style="font-size:10px">Bootstrap</a> <a href="/tags/Clojure/" style="font-size:10px">Clojure</a> <a href="/tags/DOM/" style="font-size:10px">DOM</a> <a href="/tags/Fitbit/" style="font-size:10px">Fitbit</a> <a href="/tags/Flask/" style="font-size:11px">Flask</a> <a href="/tags/Gulp/" style="font-size:10px">Gulp</a> <a href="/tags/IOS/" style="font-size:10px">IOS</a> <a href="/tags/Immutable-js/" style="font-size:10px">Immutable.js</a> <a href="/tags/JSX/" style="font-size:10px">JSX</a> <a href="/tags/Jest/" style="font-size:11px">Jest</a> <a href="/tags/Jinja2/" style="font-size:10px">Jinja2</a> <a href="/tags/Karma/" style="font-size:11px">Karma</a> <a href="/tags/LeetCode/" style="font-size:14px">LeetCode</a> <a href="/tags/Miri-僵尸网络/" style="font-size:10px">Miri 僵尸网络</a> <a href="/tags/Mori/" style="font-size:10px">Mori</a> <a href="/tags/Node/" style="font-size:11px">Node</a> <a href="/tags/Object-Detection-API/" style="font-size:10px">Object Detection API</a> <a href="/tags/Preact/" style="font-size:10px">Preact</a> <a href="/tags/Puppeteer/" style="font-size:12px">Puppeteer</a> <a href="/tags/React/" style="font-size:19px">React</a> <a href="/tags/Redux/" style="font-size:18px">Redux</a> <a href="/tags/Reflux/" style="font-size:10px">Reflux</a> <a href="/tags/RequireJs/" style="font-size:13px">RequireJs</a> <a href="/tags/RxJS/" style="font-size:11px">RxJS</a> <a href="/tags/SVG/" style="font-size:10px">SVG</a> <a href="/tags/SVG-SMIL-animation/" style="font-size:10px">SVG SMIL animation</a> <a href="/tags/TensorFlow/" style="font-size:10px">TensorFlow</a> <a href="/tags/Trie-树/" style="font-size:10px">Trie 树</a> <a href="/tags/TypeScript/" style="font-size:10px">TypeScript</a> <a href="/tags/Universal/" style="font-size:10px">Universal</a> <a href="/tags/Webpack/" style="font-size:11px">Webpack</a> <a href="/tags/cheerio/" style="font-size:10px">cheerio</a> <a href="/tags/e2e/" style="font-size:12px">e2e</a> <a href="/tags/jQuery/" style="font-size:10px">jQuery</a> <a href="/tags/left-pad/" style="font-size:10px">left-pad</a> <a href="/tags/nginx/" style="font-size:10px">nginx</a> <a href="/tags/practical-js/" style="font-size:11px">practical-js</a> <a href="/tags/r-js/" style="font-size:10px">r.js</a> <a href="/tags/redux-amrc/" style="font-size:10px">redux-amrc</a> <a href="/tags/render-react-components/" style="font-size:10px">render-react-components</a> <a href="/tags/superagent/" style="font-size:10px">superagent</a> <a href="/tags/不可变数据结构/" style="font-size:10px">不可变数据结构</a> <a href="/tags/二值化/" style="font-size:10px">二值化</a> <a href="/tags/伦理学/" style="font-size:10px">伦理学</a> <a href="/tags/函数式编程/" style="font-size:11px">函数式编程</a> <a href="/tags/单元测试/" style="font-size:14px">单元测试</a> <a href="/tags/图书/" style="font-size:10px">图书</a> <a href="/tags/字符编码/" style="font-size:10px">字符编码</a> <a href="/tags/性能/" style="font-size:10px">性能</a> <a href="/tags/技术讲座/" style="font-size:15px">技术讲座</a> <a href="/tags/数据结构与算法/" style="font-size:20px">数据结构与算法</a> <a href="/tags/机器学习/" style="font-size:10px">机器学习</a> <a href="/tags/正则表达式/" style="font-size:11px">正则表达式</a> <a href="/tags/测试/" style="font-size:16px">测试</a> <a href="/tags/爬虫/" style="font-size:10px">爬虫</a> <a href="/tags/物联网/" style="font-size:10px">物联网</a> <a href="/tags/电车问题/" style="font-size:10px">电车问题</a> <a href="/tags/端对端测试/" style="font-size:12px">端对端测试</a> <a href="/tags/纯函数/" style="font-size:10px">纯函数</a> <a href="/tags/自动化测试/" style="font-size:11px">自动化测试</a> <a href="/tags/自动驾驶汽车/" style="font-size:10px">自动驾驶汽车</a> <a href="/tags/虚拟DOM/" style="font-size:10px">虚拟DOM</a> <a href="/tags/贝塞尔曲线/" style="font-size:10px">贝塞尔曲线</a> <a href="/tags/跨域/" style="font-size:10px">跨域</a> <a href="/tags/面向对象编程/" style="font-size:10px">面向对象编程</a> <a href="/tags/黑盒测试/" style="font-size:10px">黑盒测试</a></div></div><div class="widget-wrap"><h3 class="widget-title">最新文章</h3><div class="widget"><ul><li> <a href="/2019/01/23/dfs-linked-list-in-json/">深度优先搜索和链表指针在 JSON 操作中的应用</a></li><li> <a href="/2018/08/10/appium-ios-get-started/">搭建 Appium 自动化测试环境（IOS 篇）</a></li><li> <a href="/2018/08/08/appium-android-get-started/">搭建 Appium 自动化测试环境（Android 篇）</a></li><li> <a href="/2018/07/25/ml-component-recognition/">利用机器学习进行整张设计稿多组件识别的探索</a></li><li> <a href="/2018/04/13/render-react-components/">使用 render-react-components 来单独渲染每个 React 组件</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">我的其他小站</h3><div class="widget"><ul><li><a href="http://pages.liuyiqi.cn/scroll-pages/" target="_blank">滚动吉他谱</a></li><li><a href="http://pages.liuyiqi.cn/books-tree/" target="_blank">技术书籍可视化</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"> &copy; 2019 刘一奇</div></div></footer></div><nav id="mobile-nav"> <a href="/" class="mobile-nav-link">主页</a> <a href="/archives" class="mobile-nav-link">归档</a> <a href="/about" class="mobile-nav-link">关于我</a></nav><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.jsdelivr.net/npm/blockies-identicon@0.1.0/blockies.min.js"></script><script src="/js/jquery-disqus-proxy.js?v=0.1.1"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/script.js"></script><script type="text/javascript">!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-88398388-1","auto"),ga("send","pageview")</script></div></body></html>